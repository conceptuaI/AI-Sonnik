<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gigachat Query Form</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
<div id="app">
    <div class="container">
        <div class="header">
            <h1>ü§ñ Gigachat Query Form</h1>
            <p>–û—Ç–ø—Ä–∞–≤—å—Ç–µ –∑–∞–ø—Ä–æ—Å –∏ –ø–æ–ª—É—á–∏—Ç–µ –æ—Ç–≤–µ—Ç –Ω–∏–∂–µ</p>
        </div>

        <div class="status-bar">
            <span v-if="loading" class="loading-spinner"></span>
            {{ statusMessage }}
            <button v-if="hasResponse" @click="clearResponse" class="clear-btn">
                üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –æ—Ç–≤–µ—Ç
            </button>
        </div>

        <div v-if="error" class="error-message">
            {{ error }}
        </div>

        <!-- –§–æ—Ä–º–∞ –≤–≤–æ–¥–∞ -->
        <div class="input-section">
            <div class="form-group">
                <label for="userQuery">–í–∞—à –∑–∞–ø—Ä–æ—Å:</label>
                <textarea
                        id="userQuery"
                        v-model="userInput"
                        placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å –∏–ª–∏ –∑–∞–ø—Ä–æ—Å –∑–¥–µ—Å—å..."
                        class="query-textarea"
                        :disabled="loading"
                        rows="8"
                ></textarea>
            </div>

            <div class="button-group">
                <button
                        @click="sendQuery"
                        :disabled="!userInput.trim() || loading"
                        class="submit-button"
                        :class="{ 'loading': loading }"
                >
                    <span v-if="loading">‚è≥</span>
                    <span v-else>üöÄ</span>
                    {{ loading ? '–û—Ç–ø—Ä–∞–≤–∫–∞...' : '–ü–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç' }}
                </button>

                <button
                        @click="clearForm"
                        :disabled="loading"
                        class="clear-button"
                >
                    üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å
                </button>
            </div>
        </div>

        <!-- –ë–ª–æ–∫ —Å –æ—Ç–≤–µ—Ç–æ–º -->
        <div v-if="hasResponse" class="response-section">
            <div class="response-header">
                <h3>üìã –û—Ç–≤–µ—Ç –æ—Ç Gigachat:</h3>
                <div class="response-meta">
                    <span class="timestamp">–ü–æ–ª—É—á–µ–Ω–æ: {{ formatTime(lastResponse.timestamp) }}</span>
                    <span class="char-count">{{ lastResponse.content.length }} —Å–∏–º–≤–æ–ª–æ–≤</span>
                </div>
            </div>

            <div class="response-content">
                <div class="response-text" v-html="formatResponse(lastResponse.content)"></div>
            </div>

            <div class="response-actions">
                <button @click="copyToClipboard" class="action-btn">
                    üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                </button>
                <button @click="downloadResponse" class="action-btn">
                    üíæ –°–∫–∞—á–∞—Ç—å
                </button>
            </div>
        </div>

        <!-- –ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) -->
        <div v-if="history.length > 0" class="history-section">
            <div class="history-header">
                <h3>üìú –ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤</h3>
                <button @click="clearHistory" class="clear-btn small">
                    –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é
                </button>
            </div>
            <div class="history-list">
                <div
                        v-for="(item, index) in history"
                        :key="item.id"
                        class="history-item"
                        :class="{ 'active': item.id === lastResponse.id }"
                        @click="loadFromHistory(index)"
                >
                    <div class="history-query">{{ truncateText(item.query, 80) }}</div>
                    <div class="history-meta">
                        <span class="timestamp">{{ formatTime(item.timestamp) }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="/js/app.js"></script>
</body>
</html>